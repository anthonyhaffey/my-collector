<script src="https://cdnjs.cloudflare.com/ajax/libs/tweetnacl/1.0.1/nacl.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tweetnacl-util@0.15.0/nacl-util.min.js"></script>

<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<div id="public_key"></div>
<div id="private_key"></div>
<script>

var keypair = nacl.box.keyPair();

$("#public_key").html(JSON.stringify(keypair.publicKey));
$("#private_key").html(JSON.stringify(keypair.secretKey));

var raw_message = "hi there";
var nonce = "beep";

var encrypted_message = nacl.box(raw_message, nonce, theirPublicKey, mySecretKey);



var encrypted_message = "";




/* 
** You'll need to generate a key pair for your users e.g.
** const keypair = nacl.box.keyPair()
** const receiverPublicKey = util.encodeBase64(keypair.publicKey)
** const receiverSecretKey = util.encodeBase64(keypair.secretKey)
**
*/

/* encrypted message interface */
/*
interface IEncryptedMsg {  
  ciphertext: string  
  ephemPubKey: string  
  nonce: string  
  version: string
}
*/
/* This function encrypts a message using a base64 encoded
** publicKey such that only the corresponding secretKey will
** be able to decrypt
*/
function encrypt(receiverPublicKey, msgParams) {  //: string
  const ephemeralKeyPair = nacl.box.keyPair()  
  const pubKeyUInt8Array = util.decodeBase64(receiverPublicKey)  
  const msgParamsUInt8Array = util.decodeUTF8(msgParams)  
  const nonce = nacl.randomBytes(nacl.box.nonceLength)
  const encryptedMessage = nacl.box(
     msgParamsUInt8Array,
     nonce,        
     pubKeyUInt8Array,
     ephemeralKeyPair.secretKey
  )  
  return {    
    ciphertext: util.encodeBase64(encryptedMessage),    
    ephemPubKey: util.encodeBase64(ephemeralKeyPair.publicKey),
    nonce: util.encodeBase64(nonce),     
    version: "x25519-xsalsa20-poly1305"  
  }
  
}
/* Decrypt a message with a base64 encoded secretKey (privateKey) */
function decrypt(receiverSecretKey, encryptedData) {  
  const receiverSecretKeyUint8Array = util.decodeBase64(
      receiverSecretKey
  )      
  const nonce = util.decodeBase64(encryptedData.nonce)      
  const ciphertext = util.decodeBase64(encryptedData.ciphertext)      
  const ephemPubKey = util.decodeBase64(encryptedData.ephemPubKey)      
  const decryptedMessage = nacl.box.open(
      ciphertext, 
      nonce,          
      ephemPubKey, 
      receiverSecretKeyUint8Array
  )
  return util.encodeUTF8(decryptedMessage)        
}

</script>